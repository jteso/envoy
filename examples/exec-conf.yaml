# curl -i -X POST http://10.3.3.3:8080/payment
# "([^\\s]+(\\.(?i)(ico|jpg|gif|bmp|png|css|js|html)$)",
basedir: gateway
policies:
  default_policy:
    - access: {allow: ["127.0.0.1", "10.5.5.1", "10.3.3.1"], deny: ["*"]}

proxies:
  payment_batch:
    pattern: "/payment"
    method: GET
    policy:
      - $default_policy
      - log:  {upstream: ["HeaderNames=> ", "$message.req.headers.names", " || Origin=> ", "$message.req.header.Origin"],
               downstream: ["response"] }
      - cors: {AllowedOrigins: ["*"]}
      - exec: {command: "examples/hooks/sayhi.sh"}

  web_server:
    pattern: "/:file"
    method: GET
    policy:
      - static: {filter: "[^\\\\s]+(\\.)(?i)(ico|jpg|gif|bmp|png|css|js|html|md)$",
                 location: "/opt/gopath/src/github.com/jteso/envoy/examples/www"}

  mock_services_preflight:
    pattern: "/Accounts/"
    method: OPTIONS
    policy:
      - cors: {AllowedOrigins: ["*"]}
      - log: {upstream: ["Origin: ", "$message.req.header.Origin", ", Headers: ", "$message.req.headers.names"],
              downstream: [""]}

  mock_services:
    pattern: "/Accounts/"
    method: GET
    policy:
       # Do the validation on behalf of the server and making sure ACAO is populated in the response, otherwise
       # the browser will reject it
      - cors: {AllowedOrigins: ["*"]}
      - log: {upstream: ["Origin: ", "$message.req.header.Origin", ", Headers: ", "$message.req.headers.names"],
              downstream: [""]}
      - http_endpoint: {url: "http://10.3.3.3:8181"}

